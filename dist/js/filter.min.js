function showFlorPlan(){$(".entrance-flats").hover(function(){var l=$(this).offset().top,t=$(this).closest(".result-tile").offset().top,a=l-t-3,e=$(this).data();$(".floor-plan").css({top:a,display:"block"}),$(".floor-plan__link").attr("href",e)},function(){$(".floor-plan").css("display","none")}),$(".floor-plan").hover(function(){$(this).css("display","block")},function(){$(this).css("display","none")})}function tooltipShow(){$(".entrance-flats__item").hover(function(){var l=$(".result-tile-wrap").offset().top,t=$(".result-tile-wrap").offset().left,a=$(this).offset().top,e=$(this).offset().left,r=a-l,s=e-t,o=$(".entrance-tooltip"),i=o.height(),n=o.width();$(this).hasClass("entrance-flats__item_not_available")||(o.css({top:r-i-25,left:s-2*n-25,opacity:"1"}),$(".entrance-tooltip__num").html($(this).data("num")),$(".entrance-tooltip__price").html($(this).data("price")),$(".entrance-tooltip__square").html($(this).data("square")),$(".entrance-tooltip__price_meter").html($(this).data("price_m")),$(".entrance-tooltip__rooms").html($(this).data("rooms")),$(".entrance-tooltip__image").attr("src",$(this).data("image")))},function(){$(".entrance-tooltip").css({opacity:"0",left:"-999px"})})}function getFlats(l,t){var a=[],e=[];for(var r in l){var s=l[r];a.push(s)}return a.forEach(function(l){"1"==l.sale&&e.push(l)}),$(".result-short_all-js").html(t),$(".result-short_free-js").html(e.length),a}function flatsShow(l,t){function a(l){switch(l.sale){case"1":return"<li class='result-plan-list__item'><a href='"+l.url+"' class='result-plan-list__image-link'><img src='"+l.img+"' alt='plan-image' class='result-plan-list__image'></a><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>"+l.price+" грн</p><p class='result-plan-info__text'>"+l.all_room+"м<sup>2</sup> – "+l.price_m2+" грн/м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_green'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+l.floor+" этаж</p><p class='result-plan-info__text'>№ "+l.number+"</p></div></div><a href='#' class='rooms__link result-plan__rooms-link'>"+l.rooms+"K</a><a href='"+l.url+"' class='button result-plan__button border-gradient'>Подробнее</a></li>";case"2":return"<li class='result-plan-list__item'><a href='"+l.url+"' class='result-plan-list__image-link'><img src='"+l.img+"' alt='plan-image' class='result-plan-list__image'></a><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>Бронь</p><p class='result-plan-info__text'>"+l.all_room+"м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_yellow'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+l.floor+" этаж</p><p class='result-plan-info__text'>№ "+l.number+"</p></div></div><a href='#' class='rooms__link result-plan__rooms-link'>"+l.rooms+"K</a><p class='result-plan-info__text result-plan-info__text_center'>Помещение недоступно для покупки</p></li>";case"3":return"<li class='result-plan-list__item'><a href='"+l.url+"' class='result-plan-list__image-link'><img src='"+l.img+"' alt='plan-image' class='result-plan-list__image'></a><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>Бронь</p><p class='result-plan-info__text'>"+l.all_room+"м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_gray'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+l.floor+" этаж</p><p class='result-plan-info__text'>№ "+l.number+"</p></div></div><a href='#' class='rooms__link result-plan__rooms-link'>"+l.rooms+"K</a><p class='result-plan-info__text result-plan-info__text_center'>Помещение недоступно для покупки</p></li>";case"0":return"<li class='result-plan-list__item'><a href='"+l.url+"' class='result-plan-list__image-link'><img src='"+l.img+"' alt='plan-image' class='result-plan-list__image'></a><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>Бронь</p><p class='result-plan-info__text'>"+l.all_room+"м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_dark-gray'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+l.floor+" этаж</p><p class='result-plan-info__text'>№ "+l.number+"</p></div></div><a href='#' class='rooms__link result-plan__rooms-link'>"+l.rooms+"K</a><p class='result-plan-info__text result-plan-info__text_center'>Помещение недоступно для покупки</p></li>";default:return"<li class='result-plan-list__item'><a href='"+l.url+"' class='result-plan-list__image-link'><img src='"+l.img+"' alt='plan-image' class='result-plan-list__image'></a><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>Бронь</p><p class='result-plan-info__text'>"+l.all_room+"м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_gray'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+l.floor+" этаж</p><p class='result-plan-info__text'>№ "+l.number+"</p></div></div><a href='#' class='rooms__link result-plan__rooms-link'>"+l.rooms+"K</a><p class='result-plan-info__text result-plan-info__text_center'>Помещение недоступно для покупки</p></li>"}}$(".result-plan-list__item").remove();var e=getFlats(l,t);return $(".result-plan-list").append(function(l){var t="";return l.forEach(function(l,e){t+=a(l)}),t}(e))}function flatsShowTable(l,t){function a(l){switch(l.sale){case"1":return"<div class='color-box color-box_green filter-table__color-box'></div>";case"2":return"<div class='color-box color-box_yellow filter-table__color-box'></div>";case"3":return"<div class='color-box color-box_gray filter-table__color-box'></div>";case"0":return"<div class='color-box color-box_dark-gray filter-table__color-box'></div>";default:return"<div class='color-box filter-table__color-box'></div>"}}var e,r,s,o,i,n,c=getFlats(l,t),_="Нет значения";return $(".filter-table__body").append(function(l){$(".filter-table__row").remove();var t="";return l.forEach(function(l){var c=l.properties;for(var p in c){var u=c[p];for(var f in u)"Прихожая"==u.property_name?r=u.property_flat:"Кухня"==u.property_name?s=u.property_flat:"Гостиная"==u.property_name?o=u.property_flat:"Лоджия 2"==u.property_name?n=u.property_flat:"Спальня"==u.property_name?i=u.property_flat:"Санузел"==u.property_name?e=u.property_flat:"Жилая площадь"==u.property_name&&(_=u.property_flat)}t+="<tr class='filter-table__row'><td class='filter-table__col'>"+l.floor+"</td><td class='filter-table__col'>"+a(l)+"</td><td class='filter-table__col'>"+_+"</td><td class='filter-table__col'>"+r+"</td><td class='filter-table__col'>"+s+"</td><td class='filter-table__col'>"+o+"</td><td class='filter-table__col'>"+n+"</td><td class='filter-table__col'>"+i+"</td><td class='filter-table__col'>"+e+"</td></tr>"}),t}(c))}function entranceShow(l){function t(l){switch(l.sale){case"1":return"<li class='entrance-flats__item'data-image='"+l.img+"'data-square='"+l.all_room+"'data-price_m='"+l.price_m2+"'data-price='"+l.price+"'data-rooms='"+l.rooms+"'data-num='"+l.number+"'><a href='"+l.url+"' class='entrance-flats__color-box color-box_green'>"+l.rooms+"</a></li>";case"2":return"<li class='entrance-flats__item'data-image='"+l.img+"'data-square='"+l.all_room+"'data-price_m='"+l.price_m2+"'data-price='"+l.price+"'data-rooms='"+l.rooms+"'data-num='"+l.number+"'><a href='"+l.url+"' class='entrance-flats__color-box color-box_yellow'>"+l.rooms+"</a></li>";case"3":return"<li class='entrance-flats__item'data-image='"+l.img+"'data-square='"+l.all_room+"'data-price_m='"+l.price_m2+"'data-price='"+l.price+"'data-rooms='"+l.rooms+"'data-num='"+l.number+"'><a href='"+l.url+"' class='entrance-flats__color-box color-box_gray'>"+l.rooms+"</a></li>";case"0":return"<li class='entrance-flats__item'data-image='"+l.img+"'data-square='"+l.all_room+"'data-price_m='"+l.price_m2+"'data-price='"+l.price+"'data-rooms='"+l.rooms+"'data-num='"+l.number+"'><a href='"+l.url+"' class='entrance-flats__color-box color-box_dark-gray'>"+l.rooms+"</a></li>";default:return"<li class='entrance-flats__item entrance-flats__item_not_available'data-image='"+l.img+"'data-square='"+l.all_room+"'data-price_m='"+l.price_m2+"'data-price='"+l.price+"'data-rooms='"+l.rooms+"'data-num='"+l.number+"'><a href='"+l.url+"' class='entrance-flats__color-box color-box_gray'></a></li>"}}function a(l){var t,a="";for(var r in l)a+="<div class='entrance'><p class='entrance__num'>"+r+"</p><div class='entrance-flats-wrap'>"+e(l[r]).floorMarkup+"</div></div>",t=e(l[r]).maxFloor;return{finalMarkup:a,maxFloor:t}}function e(l){var t="",a=0;for(var e in l)a++,t+="<ul class='entrance-flats'>"+r(l[e])+"</ul>";return{floorMarkup:t,maxFloor:a}}function r(l){var a="";for(var e in l)a+=t(l[e]);return a}$(".entrance").remove();var s=l.data;$(".entrance-wrap").append(a(s).finalMarkup),function(l,t){$(".entrance-floor__item").remove();for(var a=+t[0];a<=+t[1];a++)$(".entrance-floor").append("<li class='entrance-floor__item'>"+a+"</li>")}(a(s).maxFloor,l.setka),tooltipShow(),showFlorPlan()}$(".filter-top__button_more").on("click",function(){$(this).toggleClass("filter-top__button_more_active"),$(this).find(".filter-top__button-icon").toggleClass("filter-top__button-icon_active"),$(".filter-full").slideToggle(),$(".filter-settings").slideUp()}),$(".filter-full__button_more").on("click",function(){$(this).toggleClass("filter-full__button_more_active"),$(this).find(".filter-full__button-icon").toggleClass("filter-full__button-icon_active"),$(".filter-settings").slideToggle()}),document.querySelectorAll(".color-box").forEach(function(l){var t=l.getAttribute("data-color");"green"==t?$(l).addClass("color-box_green"):"yellow"==t?$(l).addClass("color-box_yellow"):"gray"==t?$(l).addClass("color-box_gray"):"dark-gray"==t&&$(l).addClass("color-box_dark-gray")}),showFlorPlan(),$(".result-short__select").on("click",function(){$(this).siblings(".view-list").slideToggle()}),$(".view-list__item").on("click",function(){var l=$(this).find(".view-list__text").html(),t="#"+$(this).find(".view-list__icon").attr("id"),a=$(this).closest(".result-short__select-wrap").find(".result-short__select-icon");$(this).closest(".result-short__select-wrap").find(".result-short__select").html(l),a.find("use").attr("xlink:href",t),$(this).closest(".view-list").css("display","none");var e=$(this).index();0===e?($(".result-plan").fadeIn(),$(".result-tile-wrap").css("display","none"),$(".result-list").css("display","none")):2===e?($(".result-tile-wrap").fadeIn(),$(".result-list").css("display","none"),$(".result-plan").css("display","none")):1===e&&($(".result-list").fadeIn(),$(".result-tile-wrap").css("display","none"),$(".result-plan").css("display","none"))}),tooltipShow();var filterDefautl={count:"12",typ:"3",page:"1",option:{price:getDefaulValue($("input[name='price']")),all_room:getDefaulValue($("input[name='all_room']")),rooms:[],floor:getDefaulValue($("input[name='floor']")),house:$(".building").data("house"),project_id:$(".building").data("id")}},filter=objClone(filterDefautl);rangesValue(),getRoomsNumber(),$(".filter__button-js").on("click",function(l){l.preventDefault(),$(".residence-list__item").remove(),console.log(filter),$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(l){console.log(l),entranceShow(l),flatsShow(l.dataList,l.quantity),flatsShowTable(l.dataList,l.quantity),paginationItemShow(l.quantity,flatsShow),paginationItemShow(l.quantity,flatsShowTable)},error:function(l){console.log(l)}})});