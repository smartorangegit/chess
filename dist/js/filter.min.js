function showFlorPlan(){$(".entrance-flats").hover(function(){var t=$(this).offset().top,l=$(this).closest(".result-tile").offset().top,a=t-l-3,e=$(this).data();$(".floor-plan").css({top:a,display:"block"}),$(".floor-plan__link").attr("href",e)},function(){$(".floor-plan").css("display","none")}),$(".floor-plan").hover(function(){$(this).css("display","block")},function(){$(this).css("display","none")})}function showFilterPagination(){$(".result-tile-wrap").hasClass("result-tile_active-js")?$(".filter-pagination").css("display","none"):$(".filter-pagination").css("display","block")}function tooltipShow(){$(".entrance-flats__item").hover(function(){var t=$(".result-tile-wrap").offset().top,l=$(".result-tile-wrap").offset().left,a=$(this).offset().top,e=$(this).offset().left,o=a-t,s=e-l,r=$(".entrance-tooltip"),i=r.height(),n=r.width();$(this).hasClass("entrance-flats__item_not_available")||(r.css({top:o-i-25,left:s-2*n-25,opacity:"1"}),$(".entrance-tooltip__num").html($(this).data("num")),$(".entrance-tooltip__price").html($(this).data("price")),$(".entrance-tooltip__square").html($(this).data("square")),$(".entrance-tooltip__price_meter").html($(this).data("price_m")),$(".entrance-tooltip__rooms").html($(this).data("rooms")),$(".entrance-tooltip__image").attr("src",$(this).data("image")))},function(){$(".entrance-tooltip").css({opacity:"0",left:"-999px"})})}function getFlats(t){var l=[];for(var a in t){var e=t[a];l.push(e)}return l}function flatsShow(t){function l(t){switch(t.sale){case"1":return"<li class='result-plan-list__item'><a href='"+t.url+"' class='result-plan-list__image-link'><img src='"+t.img+"' alt='plan-image' class='result-plan-list__image'><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>"+t.price+" грн</p><p class='result-plan-info__text'>"+t.all_room+"м<sup>2</sup> – "+t.price_m2+" грн/м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_green'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+t.floor+" этаж</p><p class='result-plan-info__text'>№ "+t.number+"</p></div></div><span class='rooms__link result-plan__rooms'>"+t.rooms+"K</span><span class='button result-plan__button border-gradient'>Подробнее</span></a></li>";case"2":return"<li class='result-plan-list__item'><a href='"+t.url+"' class='result-plan-list__image-link'><img src='"+t.img+"' alt='plan-image' class='result-plan-list__image'><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>Бронь</p><p class='result-plan-info__text'>"+t.all_room+"м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_yellow'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+t.floor+" этаж</p><p class='result-plan-info__text'>№ "+t.number+"</p></div></div><span class='rooms__link result-plan__rooms'>"+t.rooms+"K</span><p class='result-plan-info__text result-plan-info__text_center'>Помещение недоступно для покупки</p></a></li>";case"3":return"<li class='result-plan-list__item'><a href='"+t.url+"' class='result-plan-list__image-link'><img src='"+t.img+"' alt='plan-image' class='result-plan-list__image'><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>"+t.price+" грн</p><p class='result-plan-info__text'>"+t.all_room+"м<sup>2</sup> – "+t.price_m2+" грн/м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_gray'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+t.floor+" этаж</p><p class='result-plan-info__text'>№ "+t.number+"</p></div></div><span class='rooms__link result-plan__rooms'>"+t.rooms+"K</span><span class='button result-plan__button border-gradient'>Подробнее</span></a></li>";case"0":default:return"<li class='result-plan-list__item'><a href='"+t.url+"' class='result-plan-list__image-link'><img src='"+t.img+"' alt='plan-image' class='result-plan-list__image'><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>"+t.price+" грн</p><p class='result-plan-info__text'>"+t.all_room+"м<sup>2</sup> – "+t.price_m2+" грн/м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_dark-gray'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+t.floor+" этаж</p><p class='result-plan-info__text'>№ "+t.number+"</p></div></div><span class='rooms__link result-plan__rooms'>"+t.rooms+"K</span><span class='button result-plan__button border-gradient'>Подробнее</span></a></li>"}}$(".result-plan-list__item").remove();var a=getFlats(t);return $(".result-plan-list").append(function(t){var a="";return t.forEach(function(t,e){a+=l(t)}),a}(a))}function selectHandler(){var t=document.getElementById("select_pagination").value;filter.count=t,$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(t){flatsShowTable(t.dataList)},error:function(t){console.log(t)}})}function flatsShowTable(t,l){function a(t){switch(t){case"1":return"<div class='color-box color-box_green filter-table__color-box'></div>";case"2":return"<div class='color-box color-box_yellow filter-table__color-box'></div>";case"3":return"<div class='color-box color-box_gray filter-table__color-box'></div>";case"0":return"<div class='color-box color-box_dark-gray filter-table__color-box'></div>";default:return"<div class='color-box filter-table__color-box'></div>"}}var e=getFlats(t);return $(".filter-table__head").append(function(t){$(".filter-table__heading").remove();var l="";return t.forEach(function(t,a){l+="<th data-sort='"+t[1]+"' class='filter-table__heading'>"+t[0]+"</th>"}),l}(l)),sendSortingData(),$(".filter-table__body").append(function(t,l){function e(t){for(var l in t.properties)t[l]=t.properties[l].property_flat;s.push(t)}$(".filter-table__row").remove();var o={},s=[],r="";return function(t){t.forEach(function(t){o[t[1]]=t[0]})}(l),t.forEach(e),console.log(s),s.forEach(function(t,l){var e="<tr onclick='location.href=&apos;http://apivime.smarto.com.ua"+t.url+"&apos;' class='filter-table__row'><td class='filter-table__col'>"+t.floor+"</td><td class='filter-table__col'>"+a(t.sale)+"</td><td class='filter-table__col'>"+t.life_room+"</td>";for(var s in o)"floor"!==s&&"sale"!==s&&"life_room"!==s&&(e+="<td class='filter-table__col'>"+(void 0!=t[s]?t[s]:"Нет значения")+"</td>");e+="</tr>",r+=e}),r}(e,l))}function sendSortingData(){$(".filter-table__heading").on("click",function(){$(this).toggleClass("filter-sort_top");var t=$(this).data("sort");filter.order=tableHeadingCklickCount%2==0?[t,"asc"]:[t,"desc"],tableHeadingCklickCount++,$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(t){console.log(t),flatsShowTable(t.dataList,t.dataTable),paginationItemShow(t.quantity,flatsShow,flatsShowTable)},error:function(t){console.log(t)}})})}function entranceShow(t){function l(t){switch(t.sale){case"1":return"<li class='entrance-flats__item'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_green'>"+t.rooms+"</a></li>";case"2":return"<li class='entrance-flats__item'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_yellow'>"+t.rooms+"</a></li>";case"3":return"<li class='entrance-flats__item'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_gray'>"+t.rooms+"</a></li>";case"0":return"<li class='entrance-flats__item'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_dark-gray'>"+t.rooms+"</a></li>";default:return"<li class='entrance-flats__item entrance-flats__item_not_available'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_gray'></a></li>"}}function a(t){var l,a="";for(var o in t)a+="<div class='entrance'><p class='entrance__num'>"+o+"</p><div class='entrance-flats-wrap'>"+e(t[o]).floorMarkup+"</div></div>",l=e(t[o]).maxFloor;return{finalMarkup:a,maxFloor:l}}function e(t){var l="",a=0;for(var e in t)a++,l+="<ul class='entrance-flats'>"+o(t[e])+"</ul>";return{floorMarkup:l,maxFloor:a}}function o(t){var a="";for(var e in t)a+=l(t[e]);return a}$(".entrance").remove();var s=t.data;$(".entrance-wrap").append(a(s).finalMarkup),function(t,l){$(".entrance-floor__item").remove();for(var a=+l[0];a<=+l[1];a++)$(".entrance-floor").append("<li class='entrance-floor__item'>"+a+"</li>")}(a(s).maxFloor,t.setka),tooltipShow(),showFlorPlan()}$(".filter-top__button_more").on("click",function(){$(this).toggleClass("filter-top__button_more_active"),$(this).find(".filter-top__button-icon").toggleClass("filter-top__button-icon_active"),$(".filter-full").slideToggle(),$(".filter-settings").slideUp()}),$(".filter-full__button_more").on("click",function(){$(this).toggleClass("filter-full__button_more_active"),$(this).find(".filter-full__button-icon").toggleClass("filter-full__button-icon_active"),$(".filter-settings").slideToggle()}),document.querySelectorAll(".color-box").forEach(function(t){var l=t.getAttribute("data-color");"green"==l?$(t).addClass("color-box_green"):"yellow"==l?$(t).addClass("color-box_yellow"):"gray"==l?$(t).addClass("color-box_gray"):"dark-gray"==l&&$(t).addClass("color-box_dark-gray")}),showFlorPlan(),$(".result-short__select").on("click",function(){$(this).siblings(".view-list").slideToggle()}),$(".view-list__item").on("click",function(){var t=$(this).find(".view-list__text").html(),l="#"+$(this).find(".view-list__icon").attr("id"),a=$(this).closest(".result-short__select-wrap").find(".result-short__select-icon");$(this).closest(".result-short__select-wrap").find(".result-short__select").html(t),a.find("use").attr("xlink:href",l),$(this).closest(".view-list").css("display","none");var e=$(this).index();0===e?($(".result-plan").fadeIn(),$(".result-tile-wrap").removeClass("result-tile_active-js").css("display","none"),$(".result-list").css("display","none")):2===e?($(".result-tile-wrap").addClass("result-tile_active-js").fadeIn(),$(".result-list").css("display","none"),$(".result-plan").css("display","none")):1===e&&($(".result-list").fadeIn(),$(".result-tile-wrap").removeClass("result-tile_active-js").css("display","none"),$(".result-plan").css("display","none")),showFilterPagination()}),tooltipShow();var filterDefautl={count:"12",typ:"3",page:"1",order:[],option:{price:getDefaulValue($("input[name='price']")),all_room:getDefaulValue($("input[name='all_room']")),rooms:[],floor:getDefaulValue($("input[name='floor']")),house:$(".building").data("house"),project_id:$(".building").data("id")}},filter=objClone(filterDefautl);rangesValue(),getDefaulCheckedCheckbox(filter),getRoomsNumber(),$(".filter__button-js").on("click",function(t){t.preventDefault(),$(".residence-list__item").remove(),console.log(filter),$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(t){entranceShow(t),flatsShow(t.dataList),flatsShowTable(t.dataList,t.dataTable),paginationItemShow(t.quantity,flatsShow,flatsShowTable),$(".result-short_all-js").html(t.quantity),$(".result-short_free-js").html(t.quantityFree)},error:function(t){console.log(t)}})});var tableHeadingCklickCount=1;sendSortingData();