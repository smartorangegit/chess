function showFlorPlan(){$(".entrance-flats").hover(function(){var t=$(this).offset().top,a=$(this).closest(".result-tile").offset().top,l=t-a-3,e=$(this).data();$(".floor-plan").css({top:l,display:"block"}),$(".floor-plan__link").attr("href",e)},function(){$(".floor-plan").css("display","none")}),$(".floor-plan").hover(function(){$(this).css("display","block")},function(){$(this).css("display","none")})}function showFilterPagination(){$(".result-tile-wrap").hasClass("result-tile_active-js")?$(".filter-pagination").css("display","none"):$(".filter-pagination").css("display","block")}function tooltipShow(){$(".entrance-flats__item").hover(function(){var t=$(".result-tile-wrap").offset().top,a=$(".result-tile-wrap").offset().left,l=$(this).offset().top,e=$(this).offset().left,r=l-t,o=e-a,s=$(".entrance-tooltip"),i=s.height(),n=s.width();$(this).hasClass("entrance-flats__item_not_available")||(s.css({top:r-i-25,left:o-1.4*n,opacity:"1"}),$(".entrance-tooltip__num").html($(this).data("num")),$(".entrance-tooltip__price").html($(this).data("price")),$(".entrance-tooltip__square").html($(this).data("square")),$(".entrance-tooltip__price_meter").html($(this).data("price_m")),$(".entrance-tooltip__rooms").html($(this).data("rooms")),$(".entrance-tooltip__image").attr("src",$(this).data("image")))},function(){$(".entrance-tooltip").css({opacity:"0",left:"-999px"})})}function addNewOptionToFilter(t,a){t.option.properties[a]=getDefaulValue($("input[name='"+a+"']"))}function rangeMarkup(t,a,l,e,r){return"<div id='"+t+"' class='range__item'><span class='filter_name'>"+l+"</span ><div class='filter__ranges filter__ranges_ta'><input name='"+a+"' type='range' min='"+e+"' max='"+r+"' class='filter__hidden-values js-filter__hidden-values' style='display: none;'><input class='filter__range js-filter__range'  type='text'><span class='range__text range__text_min js-filter__text_min'></span><span class='range__text range__text_max js-filter__text_max'></span></div></div>"}function getFlats(t){var a=[];for(var l in t){var e=t[l];a.push(e)}return a}function flatsShow(t){function a(t){switch(t.sale){case"1":return"<li class='result-plan-list__item'><a href='"+t.url+"' class='result-plan-list__image-link'><img src='"+t.img+"' alt='plan-image' class='result-plan-list__image'><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>"+t.price+" грн</p><p class='result-plan-info__text'>"+t.all_room+"м<sup>2</sup> – "+t.price_m2+" грн/м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_green'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+t.floor+" этаж</p><p class='result-plan-info__text'>№ "+t.number+"</p></div></div><span class='rooms__link result-plan__rooms'>"+t.rooms+"K</span><span class='button result-plan__button border-gradient'>Подробнее</span></a></li>";case"2":return"<li class='result-plan-list__item'><a href='"+t.url+"' class='result-plan-list__image-link'><img src='"+t.img+"' alt='plan-image' class='result-plan-list__image'><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>Бронь</p><p class='result-plan-info__text'>"+t.all_room+"м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_yellow'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+t.floor+" этаж</p><p class='result-plan-info__text'>№ "+t.number+"</p></div></div><span class='rooms__link result-plan__rooms'>"+t.rooms+"K</span><p class='result-plan-info__text result-plan-info__text_center'>Помещение недоступно для покупки</p></a></li>";case"3":return"<li class='result-plan-list__item'><a href='"+t.url+"' class='result-plan-list__image-link'><img src='"+t.img+"' alt='plan-image' class='result-plan-list__image'><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>"+t.price+" грн</p><p class='result-plan-info__text'>"+t.all_room+"м<sup>2</sup> – "+t.price_m2+" грн/м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_gray'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+t.floor+" этаж</p><p class='result-plan-info__text'>№ "+t.number+"</p></div></div><span class='rooms__link result-plan__rooms'>"+t.rooms+"K</span><span class='button result-plan__button border-gradient'>Подробнее</span></a></li>";case"0":default:return"<li class='result-plan-list__item'><a href='"+t.url+"' class='result-plan-list__image-link'><img src='"+t.img+"' alt='plan-image' class='result-plan-list__image'><div class='result-plan-info'><div class='result-plan-info__price'><p class='result-plan-info__text'>"+t.price+" грн</p><p class='result-plan-info__text'>"+t.all_room+"м<sup>2</sup> – "+t.price_m2+" грн/м<sup>2</sup></p><div class='color-box result-plan__color-box color-box_dark-gray'></div></div><div class='result-plan-info__floor'><p class='result-plan-info__text'>"+t.floor+" этаж</p><p class='result-plan-info__text'>№ "+t.number+"</p></div></div><span class='rooms__link result-plan__rooms'>"+t.rooms+"K</span><span class='button result-plan__button border-gradient'>Подробнее</span></a></li>"}}$(".result-plan-list__item").remove();var l=getFlats(t);return $(".result-plan-list").append(function(t){var l="";return t.forEach(function(t,e){l+=a(t)}),l}(l))}function selectHandler(){var t=document.getElementById("select_pagination").value;filter.count=t,$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(t){console.log(t),flatsShowTable(t.dataList,t.dataTable),paginationItemShow(t.quantity,flatsShow,flatsShowTable)},error:function(t){console.log(t)}})}function flatsShowTable(t,a){function l(t){switch(t){case"1":return"<div class='color-box color-box_green filter-table__color-box'></div>";case"2":return"<div class='color-box color-box_yellow filter-table__color-box'></div>";case"3":return"<div class='color-box color-box_gray filter-table__color-box'></div>";case"0":return"<div class='color-box color-box_dark-gray filter-table__color-box'></div>";default:return"<div class='color-box filter-table__color-box'></div>"}}var e=getFlats(t);return $(".filter-table__head").append(function(t){$(".filter-table__heading").remove();var a="";return t.forEach(function(t,l){a+="<th data-sort='"+t[1]+"' class='filter-table__heading'>"+t[0]+"</th>"}),a}(a)),sendSortingData(),$(".filter-table__body").append(function(t,a){function e(t){for(var a in t.properties)t[a]=t.properties[a].property_flat;o.push(t)}$(".filter-table__row").remove();var r={},o=[],s="";return function(t){t.forEach(function(t){r[t[1]]=t[0]})}(a),t.forEach(e),o.forEach(function(t,a){var e="<tr onclick='location.href=&apos;http://apivime.smarto.com.ua"+t.url+"&apos;' class='filter-table__row'><td class='filter-table__col'>"+t.floor+"</td><td class='filter-table__col'>"+l(t.sale)+"</td><td class='filter-table__col'>"+t.life_room+"</td>";for(var o in r)"floor"!==o&&"sale"!==o&&"life_room"!==o&&(e+="<td class='filter-table__col'>"+(void 0!=t[o]?t[o]:"Нет значения")+"</td>");e+="</tr>",s+=e}),s}(e,a))}function sendSortingData(){$(".filter-table__heading").on("click",function(){$(this).toggleClass("filter-sort_top");var t=$(this).data("sort");filter.order=tableHeadingCklickCount%2==0?[t,"asc"]:[t,"desc"],tableHeadingCklickCount++,$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(t){console.log(t),flatsShowTable(t.dataList,t.dataTable),paginationItemShow(t.quantity,flatsShow,flatsShowTable)},error:function(t){console.log(t)}})})}function entranceShow(t){function a(t){function a(a,l){switch(a.sale){case"1":return"<li class='"+l+"'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_green'>"+t.rooms+"</a></li>";case"2":return"<li class='"+l+"'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_yellow'>"+t.rooms+"</a></li>";case"3":return"<li class='"+l+"'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_gray'>"+t.rooms+"</a></li>";case"0":return"<li class='"+l+"'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_dark-gray'>"+t.rooms+"</a></li>";default:return"<li class='"+l+" entrance-flats__item_not_available'data-image='"+t.img+"'data-square='"+t.all_room+"'data-price_m='"+t.price_m2+"'data-price='"+t.price+"'data-rooms='"+t.rooms+"'data-num='"+t.number+"'><a href='"+t.url+"' class='entrance-flats__color-box color-box_gray'></a></li>"}}return 1==t.filter?a(t,"entrance-flats__item"):a(t,"entrance-flats__item entrance-flats__item_active")}function l(t){var a,l="";for(var r in t)l+="<div class='entrance'><p class='entrance__num'>"+r+"</p><div class='entrance-flats-wrap'>"+e(t[r]).floorMarkup+"</div></div>",a=e(t[r]).maxFloor;return{finalMarkup:l,maxFloor:a}}function e(t){var a="",l=0;for(var e in t)l++,a+="<ul class='entrance-flats'>"+r(t[e])+"</ul>";return{floorMarkup:a,maxFloor:l}}function r(t){var l="";for(var e in t)l+=a(t[e]);return l}$(".entrance").remove();var o=t.data;$(".entrance-wrap").append(l(o).finalMarkup),function(t,a){$(".entrance-floor__item").remove();for(var l=+a[0];l<=+a[1];l++)$(".entrance-floor").append("<li class='entrance-floor__item'>"+l+"</li>")}(l(o).maxFloor,t.setka),tooltipShow(),showFlorPlan()}$(".filter-top__button_more").on("click",function(){$(this).toggleClass("filter-top__button_more_active"),$(this).find(".filter-top__button-icon").toggleClass("filter-top__button-icon_active"),$(".filter-full").slideToggle(),$(".filter-settings").slideUp()}),$(".filter-full__button_more").on("click",function(){$(this).toggleClass("filter-full__button_more_active"),$(this).find(".filter-full__button-icon").toggleClass("filter-full__button-icon_active"),$(".filter-settings").slideToggle()}),document.querySelectorAll(".color-box").forEach(function(t){var a=t.getAttribute("data-color");"green"==a?$(t).addClass("color-box_green"):"yellow"==a?$(t).addClass("color-box_yellow"):"gray"==a?$(t).addClass("color-box_gray"):"dark-gray"==a&&$(t).addClass("color-box_dark-gray")}),showFlorPlan(),$(".result-short__select").on("click",function(){$(this).siblings(".view-list").slideToggle()}),$(".view-list__item").on("click",function(){var t=$(this).find(".view-list__text").html(),a="#"+$(this).find(".view-list__icon").attr("id"),l=$(this).closest(".result-short__select-wrap").find(".result-short__select-icon");$(this).closest(".result-short__select-wrap").find(".result-short__select").html(t),l.find("use").attr("xlink:href",a),$(this).closest(".view-list").css("display","none");var e=$(this).index();0===e?($(".result-plan").fadeIn(),$(".result-tile-wrap").removeClass("result-tile_active-js").css("display","none"),$(".result-list").css("display","none")):2===e?($(".result-tile-wrap").addClass("result-tile_active-js").fadeIn(),$(".result-list").css("display","none"),$(".result-plan").css("display","none")):1===e&&($(".result-list").fadeIn(),$(".result-tile-wrap").removeClass("result-tile_active-js").css("display","none"),$(".result-plan").css("display","none")),showFilterPagination()}),tooltipShow();var filterDefautl={count:"12",typ:"3",page:"1",order:[],option:{price:getDefaulValue($("input[name='price']")),all_room:getDefaulValue($("input[name='all_room']")),rooms:[],floor:getDefaulValue($("input[name='floor']")),house:$(".building").data("house"),project_id:$(".building").data("id"),properties:{}}};!function(){var t=$(".filter-settings").find(".filter-checkbox");$(".filter-full-range").find(".range__item").remove(),t.each(function(t,a){var l=$(a).prop("checked"),e=$(a).data("label"),r=e.split(" ").join(""),o=$(a).attr("id"),s=$(a).data("min"),i=$(a).data("max");rangeMarkup(r,e,s,i);l&&$(".filter-full-range").append(rangeMarkup(r,o,e,s,i)),addNewOptionToFilter(filterDefautl,o),rangesValue()})}(),$(".filter-settings-list__label").on("click",function(){var t=$(this).siblings(".filter-checkbox"),a=t.prop("checked"),l=t.data("label"),e=l.split(" ").join(""),r=t.attr("id"),o=t.data("min"),s=t.data("max");a?($("#"+e).remove(),filter.option.properties[r][0]=null,filter.option.properties[r][1]=null):($(".filter-full-range").append(rangeMarkup(e,r,l,o,s)),addNewOptionToFilter(filter,r),rangesValue())});var filter=objClone(filterDefautl);!function(){for(var t=filter.option.rooms,a=$(".filter-short-checkbox-wrap").find(".filter-checkbox"),l=0;l<a.length;l++)$(a[l]).prop("checked")&&t.push($(a[l]).attr("value"));console.log(filter)}(),rangesValue(),getRoomsNumber(),$(".filter__button-js").on("click",function(t){t.preventDefault(),$(".residence-list__item").remove(),console.log(filter),$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(t){console.log(t),entranceShow(t),flatsShow(t.dataList),flatsShowTable(t.dataList,t.dataTable),paginationItemShow(t.quantity,flatsShow,flatsShowTable),$(".result-short_all-js").html(t.quantity),$(".result-short_free-js").html(t.quantityFree)},error:function(t){console.log(t)}})});var tableHeadingCklickCount=1;sendSortingData();