function initMap(e){var o=getAllProject(e),t=document.getElementById("map");if(t){var r=new google.maps.Map(t,{zoom:11,center:{lat:50.390137,lng:30.588201},gestureHandling:"greedy"}),a={url:"/img/marker-gray.png",scaledSize:new google.maps.Size(12,12),origin:new google.maps.Point(0,0)},i=filterProj(e,r,a);void 0==i&&markersShow(r,o,a)}}function getAllProject(e){return createObjWithNecessaryProperties(e.data)}function filterProj(e,o,t){$(".filter__button-js").on("click",function(r){function a(e){var o=[];return l.forEach(function(t,r){for(var a in e){var i=e[a][0],n=e[a][1];"rooms"!=a&&(+t[a]>=i!=0&&+t[a]<=n!=0||o.push(r))}}),unsuitableArrToSuitableArr(l,o)}function i(e){var o=a(e),t=e.rooms,r=[];return 0!=t.length?(o.forEach(function(e,o){t.forEach(function(o){e.rooms==o&&r.push(e)})}),r):o}getRoomsNumber($(".home-filter-checkbox-wrap")),r.preventDefault();var n=e.data,l=createObjWithNecessaryProperties(n),s=(filter.option,function(e){var o=i(e.option),t=e.selectValue,r=[];for(var a in t)o.forEach(function(e,o){""!=t[a]&&t[a]!=e[a]&&r.push(o)});return unsuitableArrToSuitableArr(o,r)}(filter)),p=getAllProject(e);return showResultOnMap(o,p,s,t),s})}function createObjWithNecessaryProperties(e){var o=[],t=["project_adress","url_project","project_name_mini","all_room","projects_coor","price","rooms","project_price","project_city","project_region","types","development_id","development_img","project_img","project_metro","project_price_flat"];for(var r in e){var a=e[r],i={};t.forEach(function(e){for(var o in a)o==e&&(i[e]=a[o])}),o.push(i)}return o}function unsuitableArrToSuitableArr(e,o){var t=[];t=function(e){for(var o={},t=0;t<e.length;t++){o[e[t]]=!0}return Object.keys(o)}(o);for(var r=t.length-1;r>=0;r--)e.splice(t[r],1);return e}function markersShow(e,o,t){var r=[];o.forEach(function(e){var o={};o.lat=+e.projects_coor[0],o.lng=+e.projects_coor[1],o.name=e.project_name_mini,o.site=e.url_project,o.str=e.project_adress,o.devLogo=e.development_img,o.img=e.project_img,o.subway=e.project_metro,o.minPrice=e.project_price_flat,r.push(o)}),r.forEach(function(o){var r=new google.maps.Marker({position:{lat:o.lat,lng:o.lng},url:o.site,map:e,icon:t});google.maps.event.addListener(r,"click",function(){$(".map-tooltip").remove(),$(".map-page__map-wrap").append('<div class="map-tooltip"><h4 class="map-tooltip__heading">'+o.name+'</h4><div class="map-tooltip__image-wrap"><img src="'+o.img+'" alt="image" class="map-tooltip__image"></div><img src="'+o.devLogo+'" alt="logo" class="map-tooltip__logo"><ul class="map-tooltip-info"><li class="map-tooltip-info__item"><svg class="map-tooltip-info__icon map-tooltip-info__icon_small"><use xlink:href="#placeholder"></use></svg><p class="map-tooltip-info__text">'+o.subway+'<span class="map-tooltip__text-info_medium">'+o.str+'</span></p></li><li class="map-tooltip-info__item"><svg class="map-tooltip-info__icon"><use xlink:href="#price"></use></svg><p class="map-tooltip-info__text">Cтоимость квартиры – <br> <span class="map-tooltip-info__text_medium">от '+o.minPrice+' грн.</span></p></li></ul><a href="'+o.site+'" class="button booking-button map-tooltip__button">Страница объекта</a><button class="map-tooltip-close"><svg class="map-tooltip-close__icon"><use xlink:href="#cancel"></use></svg></button></div>'),$(".map-tooltip-close").on("click",function(){$(this).closest(".map-tooltip").remove()})});var a='<div id="content" class="map-tooltip_small"><p class=\'map-tooltip_small__name\'>'+o.name+"</p><p class='map-tooltip_small__str'>"+o.str+"</p></div>",i=new google.maps.InfoWindow({content:a});google.maps.event.addListener(r,"mouseover",function(){i.open(e,r),$(".gm-style-iw").siblings().remove()}),google.maps.event.addListener(r,"mouseout",function(){i.close()})})}function showResultOnMap(e,o,t,r){markersShow(e,o,{url:"/img/marker.png",scaledSize:new google.maps.Size(12,12),origin:new google.maps.Point(0,0)}),markersShow(e,t,r)}var filterDefautl={option:{price:getDefaulValue($("input[name='price']")),all_room:getDefaulValue($("input[name='all_room']")),project_price:getDefaulValue($("input[name='project_price']")),rooms:[]},selectValue:{project_city:"",project_region:"",state:"",development_id:""}},filter=objClone(filterDefautl);rangesValue(),getSelectsValue(),getRoomsNumber(),$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:{typ:"1",page:"1"},success:function(e){initMap(e)},error:function(e){console.log(e)}});