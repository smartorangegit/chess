function initMap(e){var o=getAllProject(e),t=document.getElementById("map");if(t){var a=new google.maps.Map(t,{zoom:11,center:{lat:50.390137,lng:30.588201},gestureHandling:"greedy"}),r={url:"/img/marker-gray.png",scaledSize:new google.maps.Size(12,12),origin:new google.maps.Point(0,0)},i=filterProj(e,a,r);void 0==i&&markersShow(a,o,r)}}function getAllProject(e){return createObjWithNecessaryProperties(e.data)}function filterProj(e,o,t){$(".filter__button-js").on("click",function(a){function r(e){var o=[];return l.forEach(function(t,a){for(var r in e){var i=e[r][0],n=e[r][1];"rooms"!=r&&(+t[r]>=i!=0&&+t[r]<=n!=0||o.push(a))}}),unsuitableArrToSuitableArr(l,o)}function i(e){var o=r(e),t=e.rooms,a=[];return 0!=t.length?(o.forEach(function(e,o){t.forEach(function(o){e.rooms==o&&a.push(e)})}),a):o}a.preventDefault();var n=e.data,l=createObjWithNecessaryProperties(n),s=(filter.option,function(e){var o=i(e.option),t=e.selectValue,a=[];for(var r in t)o.forEach(function(e,o){""!=t[r]&&t[r]!=e[r]&&a.push(o)});return unsuitableArrToSuitableArr(o,a)}(filter)),p=getAllProject(e);return showResultOnMap(o,p,s,t),s})}function createObjWithNecessaryProperties(e){var o=[],t=["project_adress","url_project","project_name_mini","all_room","projects_coor","price","rooms","project_price","project_city","project_region","types","development_id","development_img","project_img","project_metro","project_price_flat"];for(var a in e){var r=e[a],i={};t.forEach(function(e){for(var o in r)o==e&&(i[e]=r[o])}),o.push(i)}return o}function unsuitableArrToSuitableArr(e,o){var t=[];t=function(e){for(var o={},t=0;t<e.length;t++){o[e[t]]=!0}return Object.keys(o)}(o);for(var a=t.length-1;a>=0;a--)e.splice(t[a],1);return e}function markersShow(e,o,t){var a=[];o.forEach(function(e){var o={};o.lat=+e.projects_coor[0],o.lng=+e.projects_coor[1],o.name=e.project_name_mini,o.site=e.url_project,o.str=e.project_adress,o.devLogo=e.development_img,o.img=e.project_img,o.subway=e.project_metro,o.minPrice=e.project_price_flat,a.push(o)}),a.forEach(function(o){var a=new google.maps.Marker({position:{lat:o.lat,lng:o.lng},url:o.site,map:e,icon:t});google.maps.event.addListener(a,"click",function(){$(".map-tooltip").remove(),$(".map-page__map-wrap").append('<div class="map-tooltip"><h4 class="map-tooltip__heading">'+o.name+'</h4><div class="map-tooltip__image-wrap"><img src="'+o.img+'" alt="image" class="map-tooltip__image"></div><img src="'+o.devLogo+'" alt="logo" class="map-tooltip__logo"><ul class="map-tooltip-info"><li class="map-tooltip-info__item"><svg class="map-tooltip-info__icon"><use xlink:href="#placeholder"></use></svg><p class="map-tooltip-info__text">'+o.subway+'<span class="map-tooltip__text-info_medium">'+o.str+'</span></p></li><li class="map-tooltip-info__item"><svg class="map-tooltip-info__icon"><use xlink:href="#price"></use></svg><p class="map-tooltip-info__text">Cтоимость квартиры – <span class="map-tooltip-info__text_medium">от '+o.minPrice+' грн.</span></p></li></ul><a href="'+o.site+'" class="button booking-button map-tooltip__button">Страница объекта</a><button class="map-tooltip-close"><svg class="map-tooltip-close__icon"><use xlink:href="#cancel"></use></svg></button></div>'),$(".map-tooltip-close").on("click",function(){$(this).closest(".map-tooltip").remove()})});var r='<div id="content" class="map-tooltip_small"><p class=\'map-tooltip_small__name\'>'+o.name+"</p><p class='map-tooltip_small__str'>"+o.str+"</p></div>",i=new google.maps.InfoWindow({content:r});google.maps.event.addListener(a,"mouseover",function(){i.open(e,a),$(".gm-style-iw").siblings().remove()}),google.maps.event.addListener(a,"mouseout",function(){i.close()})})}function showResultOnMap(e,o,t,a){markersShow(e,o,{url:"/img/marker.png",scaledSize:new google.maps.Size(12,12),origin:new google.maps.Point(0,0)}),markersShow(e,t,a)}var filterDefautl={option:{price:getDefaulValue($("input[name='price']")),all_room:getDefaulValue($("input[name='all_room']")),project_price:getDefaulValue($("input[name='project_price']")),rooms:[]},selectValue:{project_city:"",project_region:"",state:"",development_id:""}},filter=objClone(filterDefautl);rangesValue(),getSelectsValue(),getRoomsNumber(),$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:{typ:"1",page:"1"},success:function(e){initMap(e)},error:function(e){console.log(e)}});