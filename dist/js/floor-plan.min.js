function addNewOptionToFilter(t,e){t.option.properties[e]=getDefaulValue($("input[name='"+e+"']"))}function rangeMarkup(t,e,o,s,l){return"<div id='"+t+"' class='range__item'><span class='filter_name'>"+o+"</span ><div class='filter__ranges filter__ranges_ta'><input name='"+e+"' type='range' min='"+s+"' max='"+l+"' class='filter__hidden-values js-filter__hidden-values' style='display: none;'><input class='filter__range js-filter__range'  type='text'><span class='range__text range__text_min js-filter__text_min'></span><span class='range__text range__text_max js-filter__text_max'></span></div></div>"}function request(){$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(t){planDraw(t)},error:function(t){console.log(t)}})}function planDraw(t){var e=getCoord(t),o=getParam(t),s=t.img[0],l=t.img[1];t.img[name];console.log(o),$(".svg-wrap").css({width:s+"px",height:l+"px"}),function(t){function r(t,e,s){var l=n[s].mid[0],r=n[s].mid[1];switch(e[s].sale){case"1":return"<g class='floor-svg__grup'><a href='http://apivime.smarto.com.ua"+e[s].url+"'><polygon id='"+e[s].id+"' class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+l+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_green' width='20' height='20'/><text x='"+(l+7)+"' y='"+(r+14)+"' class='floor-svg__text floor-svg__text_white'>"+o[s].rooms+"</text></g><g><rect x='"+(l+20)+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_green_lighter' width='65' height='20'/><text x='"+(l+26)+"' y='"+(r+14)+"' class='floor-svg__text floor-svg__text_black'>"+o[s].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";case"2":return"<g class='floor-svg__grup'><a href='http://apivime.smarto.com.ua"+e[s].url+"'><polygon id='"+e[s].id+"' class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+l+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_yellow' width='20' height='20'/><text x='"+(l+7)+"' y='"+(r+14)+"' class='floor-svg__text floor-svg__text_white'>"+o[s].rooms+"</text></g><g><rect x='"+(l+20)+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_yellow_lighter' width='65' height='20'/><text x='"+(l+26)+"' y='"+(r+14)+"' class='floor-svg__text floor-svg__text_black'>"+o[s].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";case"3":return"<g class='floor-svg__grup'><a href='http://apivime.smarto.com.ua"+e[s].url+"'><polygon id='"+e[s].id+"' class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+l+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_gray' width='20' height='20'/><text x='"+(l+7)+"' y='"+(r+14)+"' class='floor-svg__text floor-svg__text_white'>"+o[s].rooms+"</text></g><g><rect x='"+(l+20)+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_gray_lighter' width='65' height='20'/><text x='"+(l+26)+"' y='"+(r+14)+"' class='floor-svg__text floor-svg__text_black'>"+o[s].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";case"0":return"<g class='floor-svg__grup'><a href='http://apivime.smarto.com.ua"+e[s].url+"'><polygon id='"+e[s].id+"' class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+l+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_dark-gray' width='20' height='20'/><text x='"+(l+7)+"' y='"+(r+14)+"' class='floor-svg__text floor-svg__text_white'>"+o[s].rooms+"</text></g><g><rect x='"+(l+20)+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_dark-gray_lighter' width='65' height='20'/><text x='"+(l+26)+"' y='"+(r+14)+"' class='floor-svg__text floor-svg__text_black'>"+o[s].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";default:return"<g class='floor-svg__grup'><a href='http://apivime.smarto.com.ua"+e[s].url+"'><polygon id='"+e[s].id+"' class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+l+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_dark-gray' width='20' height='20'/><text x='"+(l+7)+"' y='"+(r+14)+"' class='floor-svg__text floor-svg__text_white'>"+o[s].rooms+"</text></g><g><rect x='"+(l+20)+"' y='"+r+"' class='floor-svg__rect floor-svg__rect_dark-gray_lighter' width='65' height='20'/><text x='"+(l+26)+"' y='"+(r+14)+"' class='floor-svg__text'>"+o[s].square+" м<tspan class='sup'>2</tspan></text></g></a></g>"}}var a=$(".svg-wrap"),i="",n=getPolygonsCenter(e);e.forEach(function(t,e){i+=r(t,o,e)});var c="<svg class='floor-svg' width='"+s+"' height='"+l+"' version='1.0' xmlns='http://www.w3.org/2000/svg'><image xlink:href='img/floor.png' x='0' y='0' height='100%' width='100%' />"+i+"</svg>";a.append(c),polygonHover(o),zooming()}()}function getCoord(t){var e=t.dataList,o=[];return e.forEach(function(t,e){null!=t.sorts&&o.push(t.sorts)}),o}function getParam(t){var e=t.dataList,o=[];return e.forEach(function(t,e){var s={};null!=t.sorts&&(s.rooms=t.rooms,s.square=t.all_room,s.sale=t.sale,s.id=t.id,s.totalPrice=t.price,s.meterPrice=t.price_m2,s.url=t.url,o.push(s))}),o}function getPolygonsCenter(t){var e=[];return t=t.map(function(t){return t.split(",")}),t.forEach(function(t){t=t.map(function(t){return t=+t}),e.push(t)}),function(t){var e=[];return t.forEach(function(t){for(var o={},s=[],l=[],r=0;r<t.length;r++)r%2==0?s.push(t[r]):l.push(t[r]);var a=[],i=Math.max.apply(Math,s),n=Math.max.apply(Math,l);a.push(i),a.push(n);var c=[],_=Math.min.apply(Math,s),f=Math.min.apply(Math,l);c.push(_),c.push(f);var g=[],p=i-(i-_)/2-10,u=n-(n-f)/2-10;g.push(p),g.push(u),o.min=c,o.max=a,o.mid=g,e.push(o)}),e}(t)}function polygonHover(t){function e(e){var o=$(e).attr("id"),s="";$(".flat-tooltip_big").remove(),t.forEach(function(t){var e=t.sale;if(o==t.id)switch(e){case"1":return s="<div class='flat-tooltip_big'><div class='flat-tooltip-num'><div class='flat-tooltip-num__rooms flat-tooltip-num__rooms_green'>"+t.rooms+"K</div><div class='flat-tooltip-num__num'>№"+t.id+"</div></div><div class='flat-tooltip-price'><p class='flat-tooltip-price__text'>"+t.totalPrice+" грн.</p><p class='flat-tooltip-price__text flat-tooltip-price__text_lower'>"+t.square+" м<sup>2</sup> – <span class='flat-tooltip-price__text_gray'>"+t.meterPrice+" грн/м<sup>2</sup></span></p></div></div>";case"2":return s="<div class='flat-tooltip_big'><div class='flat-tooltip-num'><div class='flat-tooltip-num__rooms flat-tooltip-num__rooms_yellow'>"+t.rooms+"K</div><div class='flat-tooltip-num__num'>№"+t.id+"</div></div><div class='flat-tooltip-price'><p class='flat-tooltip-price__text'>Бронь";case"0":return s="<div class='flat-tooltip_big'><div class='flat-tooltip-num'><div class='flat-tooltip-num__rooms flat-tooltip-num__rooms_dark-gray'>"+t.rooms+"K</div><div class='flat-tooltip-num__num'>№"+t.id+"</div></div><div class='flat-tooltip-price'><p class='flat-tooltip-price__text'>Продано</p><p class='flat-tooltip-price__text flat-tooltip-price__text_lower'>"+t.square+" м<sup>2</sup></p></div></div>";case"3":default:return s="<div class='flat-tooltip_big'><p>Помещение недоступно</p></div>"}}),$(".svg-wrap").append(s)}function o(e){var o=e.getBoundingClientRect().left,s=e.getBoundingClientRect().top,l=document.getElementsByClassName("plan-wrap")[0],r=l.getBoundingClientRect().left,a=l.getBoundingClientRect().top,i=s-a,n=o-r,c=$(".flat-tooltip_big"),_=c.height(),f=c.width();c.css({top:i-.3*_+"px",left:n+.3*f+"px",opacity:"1"}),c.hover(function(t){$(this).css({top:i-.3*_+"px",left:n+.3*f+"px",opacity:"1"})}),$(e).siblings().css("display","none"),function(){var o=$(e).attr("id");t.forEach(function(t){var s=t.sale;if(o==t.id)switch(s){case"1":return $(e).css("fill","#219277");case"2":return $(e).css("fill","#FFB142");case"3":return $(e).css("fill","#666665");case"0":default:return $(e).css("fill","#454C53")}})}()}function s(t){$(t).siblings().css("display","block"),$(".flat-tooltip_big").css({opacity:"0",left:"-999px"}),$(t).css("fill","transparent")}$(".floor-svg__polygon").hover(function(t){var s=this;e(s),o(s)},function(t){s(this)})}function zooming(){var t=1;$(".zoom-button__button_plus").on("click",function(){t<1.8&&(t+=.2),$(".floor-svg").css("transform","scale("+t+")"),imageDrag(t)}),$(".zoom-button__button_minus").on("click",function(){t>1&&(t-=.2),$(".floor-svg").css("transform","scale("+t+")"),imageDrag(t)}),function(){document.getElementsByClassName("plan-wrap")[0].addEventListener("wheel",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var o=e.deltaY||e.detail||e.wheelDelta;o<0?t<2&&(t+=-o/3e3):o>1&&t>1&&(t+=-o/3e3),$(".floor-svg").css("transform","translate(0, 0) scale("+t+")"),imageDrag(t)})}(),imageDrag(1)}function imageDrag(t){var e=document.getElementsByClassName("floor-svg")[0],o=document.getElementsByClassName("plan-wrap")[0],s=document.getElementsByTagName("body")[0];o.onmousedown=function(l){var r=o.getBoundingClientRect(),a=e.getBoundingClientRect(),i=l.clientX-r.left,n=l.clientY-r.top,c=a.top-r.top-n,_=a.left-r.left-i;$(e).css("transform","translate(0, 0) scale("+t+")"),$(s).mousemove(function(o){var s=o.clientX-r.left,l=o.clientY-r.top,a=s+_,i=l+c;$(".floor-container").css({cursor:"-webkit-grab",cursor:"-moz-grab",cursor:"grab"}),t<1.5?$(e).css({left:a+10*t+"px",top:i+10*t+"px"}):$(e).css({left:a+100*t+"px",top:i+100*t+"px"})})},s.ondragstart=function(){return!1},s.onmouseup=function(){$(s).off("mousemove"),$(s).css("cursor","default"),$(".floor-container").css({cursor:"default"})}}$(".filter-top__button_more").on("click",function(){$(this).toggleClass("filter-top__button_more_active"),$(this).find(".filter-top__button-icon").toggleClass("filter-top__button-icon_active"),$(".filter-full").slideToggle(),$(".filter-settings").slideUp()}),$(".filter-full__button_more").on("click",function(){$(this).toggleClass("filter-full__button_more_active"),$(this).find(".filter-full__button-icon").toggleClass("filter-full__button-icon_active"),$(".filter-settings").slideToggle()}),$(".result-short__select").on("click",function(){$(this).siblings(".view-list").slideToggle()});var filterDefautl={count:"12",typ:"4",page:"1",order:[],option:{price:getDefaulValue($("input[name='price']")),all_room:getDefaulValue($("input[name='all_room']")),rooms:[],floor:5,house:1,project_id:1,properties:{}}};!function(){var t=$(".filter-settings").find(".filter-checkbox");$(".filter-full-range").find(".range__item").remove(),t.each(function(t,e){var o=$(e).prop("checked"),s=$(e).data("label"),l=s.split(" ").join(""),r=$(e).attr("id"),a=$(e).data("min"),i=$(e).data("max");rangeMarkup(l,s,a,i);o&&$(".filter-full-range").append(rangeMarkup(l,r,s,a,i)),addNewOptionToFilter(filterDefautl,r),rangesValue()})}(),$(".filter-settings-list__label").on("click",function(){var t=$(this).siblings(".filter-checkbox"),e=t.prop("checked"),o=t.data("label"),s=o.split(" ").join(""),l=t.attr("id"),r=t.data("min"),a=t.data("max");e?($("#"+s).remove(),filter.option.properties[l][0]=null,filter.option.properties[l][1]=null):($(".filter-full-range").append(rangeMarkup(s,l,o,r,a)),addNewOptionToFilter(filter,l),rangesValue())});var filter=objClone(filterDefautl);!function(){for(var t=filter.option.rooms,e=$(".filter-short-checkbox-wrap").find(".filter-checkbox"),o=0;o<e.length;o++)$(e[o]).prop("checked")&&t.push($(e[o]).attr("value"));console.log(filter)}(),rangesValue(),getRoomsNumber(),$(".plan-data-js").on("click",function(){console.log(this),request()}),$(".floor-nav-list__item").on("click",function(t){var e=$(this).html(),o=$(this);o.siblings().removeClass("floor-nav-list__item_active"),o.addClass("floor-nav-list__item_active"),filter.option.floor=e,$(".floor-svg").remove(),request()}),$(".filter__button-js").on("click",function(t){t.preventDefault();var e=$.param(filter),o=window.location.href+"?";o=o.substr(0,o.indexOf("?")),window.history.pushState("","",o+"?"+e),request()});