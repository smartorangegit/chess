function addNewOptionToFilter(t,e){t.option.properties[e]=getDefaulValue($("input[name='"+e+"']"))}function rangeMarkup(t,e,r,o,s){return"<div id='"+t+"' class='range__item'><span class='filter_name'>"+r+"</span ><div class='filter__ranges filter__ranges_ta'><input name='"+e+"' type='range' min='"+o+"' max='"+s+"' class='filter__hidden-values js-filter__hidden-values' style='display: none;'><input class='filter__range js-filter__range'  type='text'><span class='range__text range__text_min js-filter__text_min'></span><span class='range__text range__text_max js-filter__text_max'></span></div></div>"}function request(){$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(t){planDraw(t)},error:function(t){console.log(t)}})}function planDraw(t){var e=getCoord(t),r=getParam(t),o=t.img[0],s=t.img[1];t.img[name];console.log(t),function(t){function l(t,e,o){var s=i[o].mid[0],l=i[o].mid[1],a=e[o].sale;switch(console.log(a),a){case"1":return"<g class='floor-svg__grup'><a href='#'><polygon class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+s+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_green' width='20' height='20'/><text x='"+(s+7)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_white'>"+r[o].rooms+"</text></g><g><rect x='"+(s+20)+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_green floor-svg__rect_light' width='65' height='20'/><text x='"+(s+26)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_black'>"+r[o].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";case"2":return"<g class='floor-svg__grup'><a href='#'><polygon class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+s+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_yellow' width='20' height='20'/><text x='"+(s+7)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_white'>"+r[o].rooms+"</text></g><g><rect x='"+(s+20)+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_yellow floor-svg__rect_light' width='65' height='20'/><text x='"+(s+26)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_black'>"+r[o].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";case"3":return"<g class='floor-svg__grup'><a href='#'><polygon class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+s+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_gray' width='20' height='20'/><text x='"+(s+7)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_white'>"+r[o].rooms+"</text></g><g><rect x='"+(s+20)+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_gray floor-svg__rect_light' width='65' height='20'/><text x='"+(s+26)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_black'>"+r[o].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";case"0":default:return"<g class='floor-svg__grup'><a href='#'><polygon class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+s+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_dark-gray' width='20' height='20'/><text x='"+(s+7)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_white'>"+r[o].rooms+"</text></g><g><rect x='"+(s+20)+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_dark-gray floor-svg__rect_light' width='65' height='20'/><text x='"+(s+26)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_black'>"+r[o].square+" м<tspan class='sup'>2</tspan></text></g></a></g>"}}var a=$(".plan-wrap"),n="",i=getPolygonsCenter(e);e.forEach(function(t,e){n+=l(t,r,e)});var _="<svg class='floor-svg' width='"+o+"' height='"+s+"' version='1.0' xmlns='http://www.w3.org/2000/svg'><image xlink:href='img/floor.png' x='0' y='0' height='100%' width='100%' />"+n+"</svg>";a.append(_)}()}function getCoord(t){var e=t.dataList,r=[];return e.forEach(function(t,e){null!=t.sorts&&r.push(t.sorts)}),r}function getParam(t){var e=t.dataList,r=[];return e.forEach(function(t,e){var o={};null!=t.sorts&&(o.rooms=t.rooms,o.square=t.all_room,o.sale=t.sale,r.push(o))}),r}function getPolygonsCenter(t){var e=[];return t=t.map(function(t){return t.split(",")}),t.forEach(function(t){t=t.map(function(t){return t=+t}),e.push(t)}),function(t){var e=[];return t.forEach(function(t){for(var r={},o=[],s=[],l=0;l<t.length;l++)l%2==0?o.push(t[l]):s.push(t[l]);var a=[],n=Math.max.apply(Math,o),i=Math.max.apply(Math,s);a.push(n),a.push(i);var _=[],g=Math.min.apply(Math,o),f=Math.min.apply(Math,s);_.push(g),_.push(f);var c=[],p=n-(n-g)/2-10,u=i-(i-f)/2-10;c.push(p),c.push(u),r.mid=c,e.push(r)}),e}(t)}$(".filter-top__button_more").on("click",function(){$(this).toggleClass("filter-top__button_more_active"),$(this).find(".filter-top__button-icon").toggleClass("filter-top__button-icon_active"),$(".filter-full").slideToggle(),$(".filter-settings").slideUp()}),$(".filter-full__button_more").on("click",function(){$(this).toggleClass("filter-full__button_more_active"),$(this).find(".filter-full__button-icon").toggleClass("filter-full__button-icon_active"),$(".filter-settings").slideToggle()});var filterDefautl={count:"12",typ:"4",page:"1",order:[],option:{price:getDefaulValue($("input[name='price']")),all_room:getDefaulValue($("input[name='all_room']")),rooms:[],floor:5,house:1,project_id:1,properties:{}}};!function(){var t=$(".filter-settings").find(".filter-checkbox");$(".filter-full-range").find(".range__item").remove(),t.each(function(t,e){var r=$(e).prop("checked"),o=$(e).data("label"),s=o.split(" ").join(""),l=$(e).attr("id"),a=$(e).data("min"),n=$(e).data("max");rangeMarkup(s,o,a,n);r&&$(".filter-full-range").append(rangeMarkup(s,l,o,a,n)),addNewOptionToFilter(filterDefautl,l),rangesValue()})}(),$(".filter-settings-list__label").on("click",function(){var t=$(this).siblings(".filter-checkbox"),e=t.prop("checked"),r=t.data("label"),o=r.split(" ").join(""),s=t.attr("id"),l=t.data("min"),a=t.data("max");e?($("#"+o).remove(),filter.option.properties[s][0]=null,filter.option.properties[s][1]=null):($(".filter-full-range").append(rangeMarkup(o,s,r,l,a)),addNewOptionToFilter(filter,s),rangesValue())});var filter=objClone(filterDefautl);!function(){for(var t=filter.option.rooms,e=$(".filter-short-checkbox-wrap").find(".filter-checkbox"),r=0;r<e.length;r++)$(e[r]).prop("checked")&&t.push($(e[r]).attr("value"));console.log(filter)}(),rangesValue(),getRoomsNumber(),request(),$(".filter__button-js").on("click",function(t){t.preventDefault();var e=$.param(filter),r=window.location.href+"?";r=r.substr(0,r.indexOf("?")),window.history.pushState("","",r+"?"+e),request()});