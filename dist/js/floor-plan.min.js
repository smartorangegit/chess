function addNewOptionToFilter(t,e){t.option.properties[e]=getDefaulValue($("input[name='"+e+"']"))}function rangeMarkup(t,e,o,s,r){return"<div id='"+t+"' class='range__item'><span class='filter_name'>"+o+"</span ><div class='filter__ranges filter__ranges_ta'><input name='"+e+"' type='range' min='"+s+"' max='"+r+"' class='filter__hidden-values js-filter__hidden-values' style='display: none;'><input class='filter__range js-filter__range'  type='text'><span class='range__text range__text_min js-filter__text_min'></span><span class='range__text range__text_max js-filter__text_max'></span></div></div>"}function request(){$.ajax({url:"http://apivime.smarto.com.ua/ajax",type:"POST",dataType:"json",data:filter,success:function(t){planDraw(t)},error:function(t){console.log(t)}})}function planDraw(t){var e=getCoord(t),o=getParam(t),s=t.img[0],r=t.img[1];t.img[name];console.log(t),$(".svg-wrap").css({width:s+"px",height:r+"px"}),function(t){function s(t,e,s){var r=a[s].mid[0],l=a[s].mid[1];switch(e[s].sale){case"1":return"<g class='floor-svg__grup'><a href='#'><polygon class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+r+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_green' width='20' height='20'/><text x='"+(r+7)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_white'>"+o[s].rooms+"</text></g><g><rect x='"+(r+20)+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_green floor-svg__rect_light' width='65' height='20'/><text x='"+(r+26)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_black'>"+o[s].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";case"2":return"<g class='floor-svg__grup'><a href='#'><polygon class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+r+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_yellow' width='20' height='20'/><text x='"+(r+7)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_white'>"+o[s].rooms+"</text></g><g><rect x='"+(r+20)+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_yellow floor-svg__rect_light' width='65' height='20'/><text x='"+(r+26)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_black'>"+o[s].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";case"3":return"<g class='floor-svg__grup'><a href='#'><polygon class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+r+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_gray' width='20' height='20'/><text x='"+(r+7)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_white'>"+o[s].rooms+"</text></g><g><rect x='"+(r+20)+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_gray floor-svg__rect_light' width='65' height='20'/><text x='"+(r+26)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_black'>"+o[s].square+" м<tspan class='sup'>2</tspan></text></g></a></g>";case"0":default:return"<g class='floor-svg__grup'><a href='#'><polygon class='floor-svg__polygon' points='"+t+"'/><g><rect x='"+r+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_dark-gray' width='20' height='20'/><text x='"+(r+7)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_white'>"+o[s].rooms+"</text></g><g><rect x='"+(r+20)+"' y='"+l+"' class='floor-svg__rect floor-svg__rect_dark-gray floor-svg__rect_light' width='65' height='20'/><text x='"+(r+26)+"' y='"+(l+14)+"' class='floor-svg__text floor-svg__text_black'>"+o[s].square+" м<tspan class='sup'>2</tspan></text></g></a></g>"}}var r=$(".svg-wrap"),l="",a=getPolygonsCenter(e);e.forEach(function(t,e){l+=s(t,o,e)});var n="<svg id='ball' class='floor-svg' width='100%' height='100%' version='1.0' xmlns='http://www.w3.org/2000/svg'><image xlink:href='img/floor.png' x='0' y='0' height='100%' width='100%' />"+l+"</svg>";r.append(n),polygonHover(),zooming()}()}function getCoord(t){var e=t.dataList,o=[];return e.forEach(function(t,e){null!=t.sorts&&o.push(t.sorts)}),o}function getParam(t){var e=t.dataList,o=[];return e.forEach(function(t,e){var s={};null!=t.sorts&&(s.rooms=t.rooms,s.square=t.all_room,s.sale=t.sale,s.id=t.id,o.push(s))}),o}function getPolygonsCenter(t){var e=[];return t=t.map(function(t){return t.split(",")}),t.forEach(function(t){t=t.map(function(t){return t=+t}),e.push(t)}),function(t){var e=[];return t.forEach(function(t){for(var o={},s=[],r=[],l=0;l<t.length;l++)l%2==0?s.push(t[l]):r.push(t[l]);var a=[],n=Math.max.apply(Math,s),i=Math.max.apply(Math,r);a.push(n),a.push(i);var g=[],c=Math.min.apply(Math,s),_=Math.min.apply(Math,r);g.push(c),g.push(_);var f=[],u=n-(n-c)/2-10,p=i-(i-_)/2-10;f.push(u),f.push(p),o.min=g,o.max=a,o.mid=f,e.push(o)}),e}(t)}function polygonHover(){$(".floor-svg__polygon").hover(function(t){var e=this,o=e.getBoundingClientRect().left,s=e.getBoundingClientRect().top,r=document.getElementsByClassName("svg-wrap")[0],l=r.getBoundingClientRect().left,a=r.getBoundingClientRect().top,n=s-a,i=o-l,g=$(".flat-tooltip_big"),c=g.height(),_=g.width();g.css({top:n-.3*c+"px",left:i+.3*_+"px",opacity:"1"}),$(e).siblings().css("display","none")},function(t){var e=this;$(e).siblings().css("display","block"),$(".flat-tooltip_big").css({opacity:"0",left:"-999px"})})}function zooming(){var t=1;$(".zoom-button__button_plus").on("click",function(){t<1.8&&(t+=.2,imageDrag()),$(".floor-svg").css("transform","scale("+t+")")}),$(".zoom-button__button_minus").on("click",function(){t>1?(t-=.2,imageDrag()):1==t&&$(".floor-svg").css({left:0,top:0}),$(".floor-svg").css("transform","scale("+t+")")})}function imageDrag(){var t=document.getElementsByClassName("floor-svg")[0],e=document.getElementsByTagName("body")[0],o=document.getElementsByClassName("svg-wrap")[0];o.getBoundingClientRect().right,o.getBoundingClientRect().bottom;t.onmousedown=function(s){var r=o.getBoundingClientRect().left,l=o.getBoundingClientRect().top;$(e).mousemove(function(e){$(this).css("cursor","grab");var o=e.clientX,s=e.clientY,a=o-r-100,n=s-l-100;$(t).css({left:a+"px",top:n+"px"}),globalH=a,globalV=n})},e.ondragstart=function(){return!1},e.onmouseup=function(){$(e).off("mousemove"),$(e).css("cursor","default")}}$(".filter-top__button_more").on("click",function(){$(this).toggleClass("filter-top__button_more_active"),$(this).find(".filter-top__button-icon").toggleClass("filter-top__button-icon_active"),$(".filter-full").slideToggle(),$(".filter-settings").slideUp()}),$(".filter-full__button_more").on("click",function(){$(this).toggleClass("filter-full__button_more_active"),$(this).find(".filter-full__button-icon").toggleClass("filter-full__button-icon_active"),$(".filter-settings").slideToggle()});var filterDefautl={count:"12",typ:"4",page:"1",order:[],option:{price:getDefaulValue($("input[name='price']")),all_room:getDefaulValue($("input[name='all_room']")),rooms:[],floor:5,house:1,project_id:1,properties:{}}};!function(){var t=$(".filter-settings").find(".filter-checkbox");$(".filter-full-range").find(".range__item").remove(),t.each(function(t,e){var o=$(e).prop("checked"),s=$(e).data("label"),r=s.split(" ").join(""),l=$(e).attr("id"),a=$(e).data("min"),n=$(e).data("max");rangeMarkup(r,s,a,n);o&&$(".filter-full-range").append(rangeMarkup(r,l,s,a,n)),addNewOptionToFilter(filterDefautl,l),rangesValue()})}(),$(".filter-settings-list__label").on("click",function(){var t=$(this).siblings(".filter-checkbox"),e=t.prop("checked"),o=t.data("label"),s=o.split(" ").join(""),r=t.attr("id"),l=t.data("min"),a=t.data("max");e?($("#"+s).remove(),filter.option.properties[r][0]=null,filter.option.properties[r][1]=null):($(".filter-full-range").append(rangeMarkup(s,r,o,l,a)),addNewOptionToFilter(filter,r),rangesValue())});var filter=objClone(filterDefautl);!function(){for(var t=filter.option.rooms,e=$(".filter-short-checkbox-wrap").find(".filter-checkbox"),o=0;o<e.length;o++)$(e[o]).prop("checked")&&t.push($(e[o]).attr("value"));console.log(filter)}(),rangesValue(),getRoomsNumber(),request(),$(".filter__button-js").on("click",function(t){t.preventDefault();var e=$.param(filter),o=window.location.href+"?";o=o.substr(0,o.indexOf("?")),window.history.pushState("","",o+"?"+e),request()});